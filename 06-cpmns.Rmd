# Cooper and Means type-varieties

```{r load packages 5, echo=TRUE}
# install required analysis packages
#devtools::install_github("tidyverse/tidyverse")
#devtools::install_github("rich-iannone/DiagrammeR")
#devtools::install_github("vqv/ggbiplot")
#devtools::install_github("mlcollyer/RRPP")
#devtools::install_github("kassambara/ggpubr")
#devtools::install_github('sinhrks/ggfortify')
# load libraries
library(tidyverse)
library(DiagrammeR)
library(ggbiplot)
library(RRPP)
library(ggpubr)
library(ggfortify)
library(cluster)
```


```{r setwd ld define variables 5, echo=TRUE}
# set working directory
setwd(getwd())
# load data
data<-read.csv("garymorphlm.csv",header = TRUE, as.is=TRUE)
```

## Gary varieties proposed by Schambach [-@RN3132]

```{r schamgantt, out.width = "100%", dpi = 200, echo=TRUE, fig.cap = "Gantt charts illustrating the range of linear measurements for each type-variety reported by Schambach (1998)."}
# reported length by variety
schambl<-data.frame(Name=c('var.Gary','var.Malvern','var.LeFlore','var.Bodcaw','var.Manice','var.Camden'),
                    Length=c(51,43,43,40,36,34), # in mm
                    end=c(73,72,80,60,57,73) # in mm
)
length<-ggplot(schambl,aes(x=Length,xend=end,y=Name,yend=Name,color=Name)) +
  geom_segment(size=2) +
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "none")
# reported width by variety
schambw<-data.frame(Name=c('var.Gary','var.Malvern','var.LeFlore','var.Bodcaw','var.Manice','var.Camden'),
                    Width=c(31,23,25,21,22,14), # in mm
                    end=c(45,33,54,36,41,35) # in mm
)
width<-ggplot(schambw,aes(x=Width,xend=end,y=Name,yend=Name,color=Name)) +
  geom_segment(size=2) +
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "none")
# reported thickness by variety
schambth<-data.frame(Name=c('var.Gary','var.Malvern','var.LeFlore','var.Bodcaw','var.Manice','var.Camden'),
                     Thickness=c(6,7,5,5,6,6), # in mm
                     end=c(11,13,13,12,9,12) # in mm
)
thickness<-ggplot(schambth,aes(x=Thickness,xend=end,y=Name,yend=Name,color=Name)) +
  geom_segment(size=2) +
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "none")
# reported stem length by variety
schambstl<-data.frame(Name=c('var.Gary','var.Malvern','var.LeFlore','var.Bodcaw','var.Manice','var.Camden'),
                      StemLength=c(15,11,11,11,10,9), # in mm
                      end=c(29,23,24,24,17,22) # in mm
)
stemlength<-ggplot(schambstl,aes(x=StemLength,xend=end,y=Name,yend=Name,color=Name)) +
  geom_segment(size=2) +
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "none")
# reported stem width by variety
schambstw<-data.frame(Name=c('var.Gary','var.Malvern','var.LeFlore','var.Bodcaw','var.Manice','var.Camden'), # var.CamdenB-stemlength not listed in text
                      StemWidth=c(20,17,13,15,9,12), # in mm
                      end=c(28,25,33,24,20,24) # in mm
)
stemwidth<-ggplot(schambstw,aes(x=StemWidth,xend=end,y=Name,yend=Name,color=Name)) +
  geom_segment(size=2) +
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "none")
# render figure
schambachfig<-ggarrange(length,width,thickness,stemlength,stemwidth,
                        labels = c("a","b","c","d","e"),
                        ncol = 2, nrow = 3)
schambachfig
```

## Assign Gary type-varieties proposed by Ford and Webb [-@RN20898]

```{r tv2, echo=TRUE}
# subset data to include only those observations from Cooper and Means
cprmnsmx<-subset(data,Site %in% c("Cooper","Means"),select=maxl:Site)
# assign varieties based upon reported metrics in Schambach (1998)
slcheck1 <- cprmnsmx$maxl >= 51 & cprmnsmx$maxl <= 73
slcheck2 <- cprmnsmx$maxl >= 43 & cprmnsmx$maxl <= 72
slcheck3 <- cprmnsmx$maxl >= 43 & cprmnsmx$maxl <= 80
slcheck4 <- cprmnsmx$maxl >= 40 & cprmnsmx$maxl <= 60
slcheck5 <- cprmnsmx$maxl >= 36 & cprmnsmx$maxl <= 57
slcheck6 <- cprmnsmx$maxl >= 34 & cprmnsmx$maxl <= 73

swcheck1 <- cprmnsmx$maxw >= 22 & cprmnsmx$maxw <= 31
swcheck2 <- cprmnsmx$maxw >= 23 & cprmnsmx$maxw <= 33
swcheck3 <- cprmnsmx$maxw >= 25 & cprmnsmx$maxw <= 54
swcheck4 <- cprmnsmx$maxw >= 21 & cprmnsmx$maxw <= 36
swcheck5 <- cprmnsmx$maxw >= 22 & cprmnsmx$maxw <= 41
swcheck6 <- cprmnsmx$maxw >= 14 & cprmnsmx$maxw <= 35

stcheck1 <- cprmnsmx$maxth >= 6 & cprmnsmx$maxth <= 11
stcheck2 <- cprmnsmx$maxth >= 7 & cprmnsmx$maxth <= 13
stcheck3 <- cprmnsmx$maxth >= 5 & cprmnsmx$maxth <= 13
stcheck4 <- cprmnsmx$maxth >= 5 & cprmnsmx$maxth <= 12
stcheck5 <- cprmnsmx$maxth >= 6 & cprmnsmx$maxth <= 9
stcheck6 <- cprmnsmx$maxth >= 6 & cprmnsmx$maxth <= 12

sslcheck1 <- cprmnsmx$maxstl >= 15 & cprmnsmx$maxstl <= 29
sslcheck2 <- cprmnsmx$maxstl >= 11 & cprmnsmx$maxstl <= 23
sslcheck3 <- cprmnsmx$maxstl >= 11 & cprmnsmx$maxstl <= 24
sslcheck4 <- cprmnsmx$maxstl >= 11 & cprmnsmx$maxstl <= 24
sslcheck5 <- cprmnsmx$maxstl >= 10 & cprmnsmx$maxstl <= 17
sslcheck6 <- cprmnsmx$maxstl >= 9 & cprmnsmx$maxstl <= 22

sswcheck1 <- cprmnsmx$maxstw >= 20 & cprmnsmx$maxstw <= 28
sswcheck2 <- cprmnsmx$maxstw >= 17 & cprmnsmx$maxstw <= 25
sswcheck3 <- cprmnsmx$maxstw >= 13 & cprmnsmx$maxstw <= 33
sswcheck4 <- cprmnsmx$maxstw >= 15 & cprmnsmx$maxstw <= 24
sswcheck5 <- cprmnsmx$maxstw >= 12 & cprmnsmx$maxstw <= 24
sswcheck6 <- cprmnsmx$maxstw >= 9 & cprmnsmx$maxstw <= 20

cprmnsmx$tv2 <- "Gnv" # = Gary points (no variety)
cprmnsmx$tv2 <- ifelse(slcheck1 & swcheck1 & stcheck1 & sslcheck1 & sswcheck1, "G", cprmnsmx$tv2)
cprmnsmx$tv2 <- ifelse(slcheck2 & swcheck2 & stcheck2 & sslcheck2 & sswcheck2, "Ml", cprmnsmx$tv2)
cprmnsmx$tv2 <- ifelse(slcheck3 & swcheck3 & stcheck3 & sslcheck3 & sswcheck3, "LF", cprmnsmx$tv2)
cprmnsmx$tv2 <- ifelse(slcheck4 & swcheck4 & stcheck4 & sslcheck4 & sswcheck4, "Bd", cprmnsmx$tv2)
cprmnsmx$tv2 <- ifelse(slcheck5 & swcheck5 & stcheck5 & sslcheck5 & sswcheck5, "Mn", cprmnsmx$tv2)
cprmnsmx$tv2 <- ifelse(slcheck6 & swcheck6 & stcheck6 & sslcheck6 & sswcheck6, "Cm", cprmnsmx$tv2)

tv2<-cprmnsmx$tv2
tv2
```

## Boxplots of Schambach's [-@RN3132] type-varieties for Gary dart points from Cooper and Means

```{r boxplotctv2, out.width = "100%", dpi = 200, echo=TRUE, fig.cap = "Boxplots for a, maximum length; b, width; c, thickness; d, stem length; and e, stem width for Gary dart points from the Cooper and Means sites."}
# boxplot of maximum length
cprmaxl<-ggplot(cprmnsmx,aes(x=tv2,y=maxl,color=tv2)) + 
  geom_boxplot() +
  geom_dotplot(binaxis = 'y',stackdir = 'center',dotsize = 0.3) +
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "none")
# boxplot of maximum width
cprmaxw<-ggplot(cprmnsmx,aes(x=tv2,y=maxw,color=tv2)) + 
  geom_boxplot() +
  geom_dotplot(binaxis = 'y',stackdir = 'center',dotsize = 0.3)+
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "none")
# boxplot of maximum thickness
cprmaxth<-ggplot(cprmnsmx,aes(x=tv2,y=maxth,color=tv2)) + 
  geom_boxplot() +
  geom_dotplot(binaxis = 'y',stackdir = 'center',dotsize = 0.3)+
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "none")
# boxplot of maximum stem length
cprmaxstl<-ggplot(cprmnsmx,aes(x=tv2,y=maxstl,color=tv2)) + 
  geom_boxplot() +
  geom_dotplot(binaxis = 'y',stackdir = 'center',dotsize = 0.3)+
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "none")
# boxplot of maximum thickness
cprmaxstw<-ggplot(cprmnsmx,aes(x=tv2,y=maxstw,color=tv2)) + 
  geom_boxplot() +
  geom_dotplot(binaxis = 'y',stackdir = 'center',dotsize = 0.3)+
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "none")
# render figure
cprfigure<-ggarrange(cprmaxl,cprmaxw,cprmaxth,cprmaxstl,cprmaxstw,
                     labels = c("a","b","c","d","e"),
                     ncol = 3, nrow = 2)
cprfigure
```

## Density plots for variables by type-varieties

### Density plot for maximum length by tv2

```{r cmdensity1, out.width = "100%", dpi = 200, echo=TRUE, fig.cap = "Density plot for maximum length at Coooper and Means."}
# define variables in cooper/means subset
cm.maxl<-cprmnsmx$maxl
cm.maxw<-cprmnsmx$maxw
cm.maxth<-cprmnsmx$maxth
cm.maxstl<-cprmnsmx$maxstl
cm.maxstw<-cprmnsmx$maxstw
cm.tv2<-cprmnsmx$tv2
# density plot by maxl by tv1
ggplot(cprmnsmx, aes(x=cm.maxl, fill = cm.tv2)) +
  geom_density(alpha = .4) +
  scale_color_brewer(palette = "Set1") +
  xlim(0,150) #full range of variation included in the linear measurements
```

### Density plot for maximum width by tv2

```{r cmdensity2, out.width = "100%", dpi = 300, echo=TRUE, fig.cap = "Density plot for maximum width by tv2 at Coooper and Means."}
# density plot by maxl by tv1
ggplot(cprmnsmx, aes(x=cm.maxw, fill = cm.tv2)) +
  geom_density(alpha = .4) +
  scale_color_brewer(palette = "Set1") +
  xlim(0,75) #full range of variation included in the linear measurements
```

### Density plot for maximum thickness by tv2

```{r cmdensity3, out.width = "100%", dpi = 300, echo=TRUE, fig.cap = "Density plot for maximum thickness by tv2 at Coooper and Means."}
# density plot by maxl by tv1
ggplot(cprmnsmx, aes(x=cm.maxth, fill = cm.tv2)) +
  geom_density(alpha = .4) +
  scale_color_brewer(palette = "Set1") +
  xlim(0,25) #full range of variation included in the linear measurements
```

### Density plot for maximum stem length by tv2

```{r cmdensity4, out.width = "100%", dpi = 300, echo=TRUE, fig.cap = "Density plot for maximum stem length by tv2 at Coooper and Means."}
# density plot by maxl by tv1
ggplot(cprmnsmx, aes(x=cm.maxstl, fill = cm.tv2)) +
  geom_density(alpha = .4) +
  scale_color_brewer(palette = "Set1") +
  xlim(0,35) #full range of variation included in the linear measurements
```

### Density plot for maximum stem width by tv2

```{r cmdensity5, out.width = "100%", dpi = 300, echo=TRUE, fig.cap = "Density plot for maximum stem width by tv2 at Coooper and Means."}
# density plot by maxl by tv1
ggplot(cprmnsmx, aes(x=cm.maxstw, fill = cm.tv2)) +
  geom_density(alpha = .4) +
  scale_color_brewer(palette = "Set1") +
  xlim(0,40) #full range of variation included in the linear measurements
```

## Principal Components Analysis for Schambach's [-@RN3132] type-varieties at Cooper and Means

```{r pcatv2, out.width = "100%", dpi = 200, echo=TRUE, fig.cap = "PCA by Gary type-varieties reported by Schambach (1998)."}
#pca
df<-cprmnsmx[c(1:5)]
tv2pca<-autoplot(prcomp(df),data = cprmnsmx, colour = 'tv2',
                 loadings = TRUE, loadings.colour = 'blue',
                 loadings.label = TRUE,loadings.label.size = 3, 
                 frame = TRUE)
#render figure
tv2pca
```

## Analyses of Variance (ANOVA) for linear variables ~ Schambach's [-@RN3132] type-varieties

### _Maximum length_ by _type-variety_ at Cooper and Means

```{r cm.maxl-x-tv, out.width = "100%", dpi = 300, echo=TRUE}
# anova = maximum length ~ tv2
t2ml<-lm.rrpp(cm.maxl ~ cm.tv2, SS.type = "I",data = cprmnsmx,iter = 9999,print.progress = FALSE)
anova(t2ml)
# visualise model predictions for maximum length ~ type-variety at cooper and means
cm.tvDF<-data.frame(cm.tv2 = c("G","Ml","LF","Bd","Mn","Cm"))
rownames(cm.tvDF)<-c("G","Ml","LF","Bd","Mn","Cm")
cmPreds<-predict(t2ml,cm.tvDF)
cmPreds
plot(cmPreds, col = 1:NROW(cm.tvDF))
# pairwise comparisons not possible until more than one specimen falls within each category
# pairwise comparison of LS means = which type-varieties differ?
#cm.ml<-pairwise(t2ml, groups = cprmnsmx$tv2)
#summary(cm.ml, confidence = 0.95, test.type = "dist")
# correlation between mean vectors (angles in degrees)
#summary(cm.ml, confidence = 0.95, test.type = "VC", angle.type = "deg")
# pairwise distances between variances = standardization?
#summary(cm.ml, confidence = 0.95, test.type = "var")
```

### _Maximum width_ by _type-variety_ at Cooper and Means

```{r cm.maxw-x-tv, out.width = "100%", dpi = 300, echo=TRUE}
# anova = maximum width ~ tv2
t2mw<-lm.rrpp(cm.maxw ~ cm.tv2, SS.type = "I",data = cprmnsmx,iter = 9999,print.progress = FALSE)
anova(t2mw)
# visualise model predictions for maximum width ~ type-variety at cooper and means
cm.tvDF<-data.frame(cm.tv2 = c("G","Ml","LF","Bd","Mn","Cm"))
rownames(cm.tvDF)<-c("G","Ml","LF","Bd","Mn","Cm")
cmPreds<-predict(t2mw,cm.tvDF)
cmPreds
plot(cmPreds, col = 1:NROW(cm.tvDF))
```

### _Maximum thickness_ by _type-variety_ at Cooper and Means

```{r cm.maxth-x-tv, out.width = "100%", dpi = 300, echo=TRUE}
# anova = maximum thickness ~ tv2
t2mth<-lm.rrpp(cm.maxth ~ cm.tv2, SS.type = "I",data = cprmnsmx,iter = 9999,print.progress = FALSE)
anova(t2mth)
# visualise model predictions for maximum thickness ~ type-variety at cooper and means
cm.tvDF<-data.frame(cm.tv2 = c("G","Ml","LF","Bd","Mn","Cm"))
rownames(cm.tvDF)<-c("G","Ml","LF","Bd","Mn","Cm")
cmPreds<-predict(t2mth,cm.tvDF)
cmPreds
plot(cmPreds, col = 1:NROW(cm.tvDF))
```

### _Maximum stem length_ by _type-variety_ at Cooper and Means

```{r cm.maxstl-x-tv, out.width = "100%", dpi = 300, echo=TRUE}
# anova = maximum stem length ~ tv2
t2mstl<-lm.rrpp(cm.maxstl ~ cm.tv2, SS.type = "I",data = cprmnsmx,iter = 9999,print.progress = FALSE)
anova(t2mstl)
# visualise model predictions for maximum stem length ~ type-variety at cooper and means
cm.tvDF<-data.frame(cm.tv2 = c("G","Ml","LF","Bd","Mn","Cm"))
rownames(cm.tvDF)<-c("G","Ml","LF","Bd","Mn","Cm")
cmPreds<-predict(t2mstl,cm.tvDF)
cmPreds
plot(cmPreds, col = 1:NROW(cm.tvDF))
```

```{r anova tv2, echo=TRUE}
# anova = maximum stem width ~ tv2
t2mstw<-lm.rrpp(cm.maxstw ~ cm.tv2, SS.type = "I",data = cprmnsmx,iter = 9999,print.progress = FALSE)
anova(t2mstw)
# visualise model predictions for maximum stem width ~ type-variety at cooper and means
cm.tvDF<-data.frame(cm.tv2 = c("G","Ml","LF","Bd","Mn","Cm"))
rownames(cm.tvDF)<-c("G","Ml","LF","Bd","Mn","Cm")
cmPreds<-predict(t2mstw,cm.tvDF)
cmPreds
plot(cmPreds, col = 1:NROW(cm.tvDF))
```
